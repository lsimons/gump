<project name="embed-test" default="main" basedir=".">
  <property name="ant.src" location="../.."/>
        
  <import file="build.xml"/>

  <target name="main">
     <property name="junit.jar" location="${base.path}/junit3.7/junit.jar"/>
     <echo>${junit.jar} ${velocity.jar}</echo>

    <path id="myJars" >
      <pathelement path="${junit.jar}" />
      <pathelement path="${jxpath.jar}" />
      <pathelement path="${velocity-dep.jar}" />
      <pathelement path="${velocity.jar}" />
      <pathelement path="${jexl.jar}" />
      <pathelement path="${commons-discovery.jar}" />
      <pathelement path="${commons-logging.jar}" />
      <pathelement path="${ant.home}/lib/ant-sax2.jar" />
    </path>

    <systemPath pathRef="myJars"/>

    <junit id="replacedJunit" />
  
    <echo message="toString sample: ${toString:replacedJunit}" />
 
    <!-- This is Taksdef2.java - it'll use the systemPath as parent loader
      -->
    <taskdef classname="org.apache.tools.ant.taskdefs.optional.JXPath"
             name="jxpath" />
    <taskdef classname="org.apache.tools.ant.taskdefs.optional.JXPathSet"
             name="jxpathSet" />
    <taskdef classname="org.apache.tools.ant.taskdefs.optional.VelocityProperties"
             name="velocityProperties" />
    <taskdef classname="org.apache.tools.ant.taskdefs.optional.JexlProperties"
             name="jexlProperties" />

    <!-- Init JxPath. '/' is the project -->
    <jxpath/>
    <velocityProperties/>
    <jexlProperties/>

    <echo message="vel /references/myJars: ${vm:$ant.references.myJars}" />

    <echo message="jexl /references/myJars: ${jexl:ant.references.myJars}" />

    <echo message="jxPath /targets[1]: ${jxpath:/targets}" />
    <echo message="jxPath /targets[1]: ${jxpath:/targets[1]}" />

    <echo message="jxPath /references: ${jxpath:/references}" />
    <echo message="jxPath /references/myJars: ${jxpath:/references/myJars}" />
    <echo message="jxPath /references[@name='myJars']: ${jxpath:/references[@name='myJars']}" />
    
    <!-- Example of using an Ant property as a variable in jxpath -->
    <property name="jartoget" value="myJars"/>
    <echo message="jxPath /references[@name=$jartoget]: ${jxpath:/references[@name=$jartoget]}" /> 
    <!--                                   ^^^^^^^^^^^^                           ^^^^^^^^^^^^  -->                           
   
    <!-- This is XMLDOM.java - a datatype that holds an xml DOM  -->
    <typedef name="xmldom" classname="org.apache.tools.ant.types.XMLDOM"/>

    <!-- Init XMLDOM. The DOM of file test.xml will be referenced via the id-->
    <xmldom id="test.xml" file="test.xml"/>  
    <xmldom id="merge.xml" file="C:\Documents and Settings\barozzink\Desktop\work\merge.xml"/>  
    
    <echo message="XMLDOM (project name): ${jxpath:/references/test.xml/root/project/@name}" />

    <echo message="XMLDOM (all top-level property names): ${jxpath:/references/test.xml/root/project/property/@name}" />


    <taskdef classname="org.apache.tools.ant.taskdefs.RunTarget"
             name="antrun" />
             
    

    <echo message="XMLDOM: ${jxpath:/references/test.xml/root/project/@name}" />

    

  </target>

  <!-- Show the difference in speed between using antrun and antcall 
       Beware though that antrun is *not* reentrant, thus acting
       as a *direct* call to the target without further dependency resolution
       and without any property scope.                           
                     -->
  <target name="test-runvscall" depends="test-run, test-call"/>
    
  <target name="test-run">
    <taskdef classname="org.apache.tools.ant.taskdefs.RunTarget"
             name="antrun" />
    <antrun target="main" />
    <antrun target="main" />
    <antrun target="main" />
    <antrun target="main" />
    <antrun target="main" />            
    <antrun target="main" />
    <antrun target="main" />
    <antrun target="main" />
    <antrun target="main" />
    <antrun target="main" />       
    <antrun target="main" />
    <antrun target="main" />
    <antrun target="main" />
    <antrun target="main" />
    <antrun target="main" />       
    <antrun target="main" />
    <antrun target="main" />
    <antrun target="main" />
    <antrun target="main" />
    <antrun target="main" />               
  </target>

  <target name="test-call">
    <taskdef classname="org.apache.tools.ant.taskdefs.RunTarget"
             name="antrun" />
    <antcall target="main" />
    <antcall target="main" />
    <antcall target="main" />
    <antcall target="main" />
    <antcall target="main" />            
    <antcall target="main" />
    <antcall target="main" />
    <antcall target="main" />
    <antcall target="main" />
    <antcall target="main" />       
    <antcall target="main" />
    <antcall target="main" />
    <antcall target="main" />
    <antcall target="main" />
    <antcall target="main" />       
    <antcall target="main" />
    <antcall target="main" />
    <antcall target="main" />
    <antcall target="main" />
    <antcall target="main" />           
  </target>
  
  <!-- Test the import reference feature -->
  <target name="test-import" >
    <antcall target="embed.main" />
  </target>


</project>